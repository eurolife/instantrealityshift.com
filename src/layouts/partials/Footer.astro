---
import Logo from '@/components/Logo.astro';
import config from '@/config/config.json';
import menu from '@/config/menu.json';
import { markdownify } from '@/lib/utils/textConverter';
import type { ISocial } from '@/components/Social.astro';
import socials from '@/config/social.json';
import DynamicIcon from '@/helpers/DynamicIcon';

// Function to replace {year} this from string to year
function replaceYear(text: string) {
  const year = new Date().getFullYear();

  return text.replace('{year}', year.toString());
}
interface FooterLink {
  name: string;
  url: string;
}

interface Footer {
  company: FooterLink[];
  others: FooterLink[];
}

const { footer }: { footer: Footer } = menu;
---

<footer class="container">
  <div class="pb-20 xl:pb-32 xl:px-6">
    <div class="flex flex-col gap-20 md:flex-row justify-between">
      <!-- LEFT SIDE -->
      <div class="lg:flex gap-20 lg:gap-40">
        {
          footer.company && footer.company.length > 0 && (
            <div data-aos="fade-right-sm" data-aos-delay="100">
              <h3 class="text-sm text-text-light mb-10 uppercase">Company</h3>
              <ul>
                {footer.company.map((item) => (
                  <li class="mb-2">
                    <a
                      href={item.url}
                      class="text-text hover:text-text/70 transition-colors duration-300"
                      data-astro-reload
                    >
                      {item.name}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          )
        }
        {
          footer.others && footer.others.length > 0 && (
            <div
              data-aos="fade-right-sm"
              data-aos-delay="200"
              class="mt-12 lg:mt-0"
            >
              <h3 class="text-sm text-text-light mb-10 uppercase">Audios</h3>
              <ul>
                {footer.others.map((item) => (
                  <li class="mb-2">
                    <a
                      href={item.url}
                      class="text-text hover:text-text/70 transition-colors duration-300"
                      data-astro-reload
                    >
                      {item.name}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          )
        }
      </div>
      <!-- RIGHT SIDE -->
      <div class="max-w-[325px] lg:w-[325px]">
        <div data-aos="fade-right-sm" data-aos-delay="300">
          <h3 class="text-sm text-text-light mb-10 uppercase">FOLLOW US</h3>
          <ul class="flex gap-4 mb-10">
            {
              socials.main.map((social: ISocial) => (
                <li>
                  <a
                    aria-label={social.name}
                    href={social.link}
                    target="_blank"
                    rel="noopener noreferrer nofollow"
                    class="w-10 aspect-square grid place-items-center border border-border hover:border-white transition-colors duration-500 rounded-full"
                  >
                    <span class="sr-only">{social.name}</span>
                    <DynamicIcon className="inline-block" icon={social.icon} />
                  </a>
                </li>
              ))
            }
          </ul>
          <h3 class="text-sm text-text-light mb-10 uppercase">
            STAY UP TO DATE
          </h3>
          <div id="mc_embed_shell">
            <div id="mc_embed_signup">
              <form
                action="https://londonbowieevent.us18.list-manage.com/subscribe/post?u=7798546b97f9813b5817a7197&id=3158bf98f4&f_id=0034afe6f0"
                method="post"
                id="mc-embedded-subscribe-form"
                name="mc-embedded-subscribe-form"
                class="validate flex flex-col gap-4"
                target="_self"
                novalidate=""
              >
                <input
                  type="text"
                  name="website"
                  tabindex="-1"
                  autocomplete="off"
                  style="position: absolute; left: -5000px;"
                />
                <div id="mc_embed_signup_scroll">
                  <div class="mc-field-group">
                    <input
                      type="email"
                      name="EMAIL"
                      placeholder="Your email"
                      class="required email w-full py-3 px-4 bg-light placeholder:text-white text-text-light border border-border focus:outline-none transition-colors duration-300 rounded-lg"
                      id="mce-EMAIL"
                      required=""
                      value=""
                    />
                  </div><div
                    id="mergeRow-gdpr"
                    class="mergeRow gdpr-mergeRow content__gdprBlock mc-field-group"
                  >
                    <div class="content__gdpr text-sm">
                      <fieldset
                        class="mc_fieldset gdprRequired mc-field-group"
                        name="interestgroup_field"
                      >
                        <label class="checkbox subfield" for="gdpr105416"
                          ><input
                            type="hidden"
                            id="gdpr_105416"
                            name="gdpr[105416]"
                            class="gdpr"
                            value="Y"
                          /></label
                        >
                      </fieldset>
                      <p class="my-4 text-text-light">
                        You can unsubscribe at any time by clicking the link in
                        the footer of our emails.
                      </p>
                    </div><div class="content__gdprLegal"></div>
                  </div>
                  <div id="mce-responses" class="clear">
                    <div
                      class="response"
                      id="mce-error-response"
                      style="display: none;"
                    >
                    </div>
                    <div
                      class="response"
                      id="mce-success-response"
                      style="display: none;"
                    >
                    </div>
                  </div><div
                    aria-hidden="true"
                    style="position: absolute; left: -5000px;"
                  >
                    <input
                      type="text"
                      name="b_7798546b97f9813b5817a7197_3158bf98f4"
                      tabindex="-1"
                      value=""
                    />
                  </div><div class="clear">
                    <input
                      type="submit"
                      name="subscribe"
                      id="mc-embedded-subscribe"
                      class="button btn btn-primary rounded-lg !py-2"
                      value="Subscribe"
                    />
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="border-t border-border/60 pt-10 pb-20 xl:px-6">
    <div
      class="flex flex-col md:flex-row gap-y-10 justify-between md:items-center"
    >
      <div data-aos="fade-right-sm" data-aos-delay="100">
        <Logo />
      </div>
      <p
        class="text-sm text-text/70"
        set:html={markdownify(replaceYear(config.params.copyright))}
        data-aos="fade-right-sm"
        data-aos-delay="300"
      />
    </div>
  </div>
</footer>

<script is:inline>
  document
    .getElementById('mc-embedded-subscribe-form')
    .addEventListener('submit', function (e) {
      const honeypot = document.querySelector("input[name='website']");
      if (honeypot && honeypot.value.trim() !== '') {
        e.preventDefault(); // stop submission
        console.log('Bot detected. Form not submitted.');
        return false;
      }
    });
</script>
